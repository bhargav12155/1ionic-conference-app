<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start" *ngIf="!isMobile()">
            <ion-menu-button></ion-menu-button>
        </ion-buttons>
        <ion-title>Activity Log</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content>
    <ion-card>
        <ion-card-header>
            <ion-card-title>Geofence Entry/Exit History</ion-card-title>
            <ion-card-subtitle>Recent activity in Trinidad area</ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
            <div class="ion-padding">
                <div class="table-container" *ngIf="geofenceEvents.length > 0; else noEvents">
                    <table>
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Timestamp</th>
                                <th>Location</th>
                                <th>User ID</th>
                                <th>Device</th>
                                <th>Duration</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let event of geofenceEvents">
                                <td data-label="Type">
                                    <ion-chip [color]="getEventColor(event.type)">
                                        <ion-icon [name]="getEventIcon(event.type)"></ion-icon>
                                        <ion-label>{{ event.type.toUpperCase() }}</ion-label>
                                    </ion-chip>
                                </td>
                                <td data-label="Timestamp">{{ formatTimestamp(event.timestamp) }}</td>
                                <td data-label="Location">{{ event.location.latitude.toFixed(4) }}, {{
                                    event.location.longitude.toFixed(4) }}
                                </td>
                                <td data-label="User ID">
                                    <code>{{ event.userId }}</code>
                                </td>
                                <td data-label="Device">
                                    <span *ngIf="event.userDeviceInfo">{{ event.userDeviceInfo.model ||
                                        event.userDeviceInfo.platform || 'Unknown' }}</span>
                                </td>
                                <td data-label="Duration">
                                    <span *ngIf="event.duration && event.type === 'exit'">{{
                                        formatDuration(event.duration) }}</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <ng-template #noEvents>
                <ion-item>
                    <ion-icon name="time" slot="start"></ion-icon>
                    <ion-label>
                        <h3>No activity recorded yet</h3>
                        <p>Enter and exit the Trinidad geofence area to see activity logs</p>
                    </ion-label>
                </ion-item>
            </ng-template>
        </ion-card-content>
    </ion-card>

    <!-- Statistics Card -->
    <ion-card *ngIf="geofenceEvents.length > 0">
        <ion-card-header>
            <ion-card-title>Statistics</ion-card-title>
        </ion-card-header>
        <ion-card-content>
            <ion-grid>
                <ion-row>
                    <ion-col size="6">
                        <ion-item lines="none">
                            <ion-icon name="enter" color="success" slot="start"></ion-icon>
                            <ion-label>
                                <h3>{{ getEntriesCount() }}</h3>
                                <p>Entries</p>
                            </ion-label>
                        </ion-item>
                    </ion-col>
                    <ion-col size="6">
                        <ion-item lines="none">
                            <ion-icon name="exit" color="warning" slot="start"></ion-icon>
                            <ion-label>
                                <h3>{{ getExitsCount() }}</h3>
                                <p>Exits</p>
                            </ion-label>
                        </ion-item>
                    </ion-col>
                </ion-row>
            </ion-grid>
        </ion-card-content>
    </ion-card>

</ion-content>