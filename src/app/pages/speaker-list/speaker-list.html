<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-menu-button></ion-menu-button>
        </ion-buttons>
        <ion-title>Geofence Users</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content>
    <!-- Current User Info -->
    <ion-card *ngIf="currentUser">
        <ion-card-header>
            <ion-card-title>Your Status</ion-card-title>
        </ion-card-header>
        <ion-card-content>
            <ion-chip [color]="getStatusColor(currentUser.geofenceStatus)">
                <ion-icon name="location"></ion-icon>
                <ion-label>{{ getStatusText(currentUser.geofenceStatus) }}</ion-label>
            </ion-chip>

            <ion-item lines="none">
                <ion-icon name="navigate" slot="start"></ion-icon>
                <ion-label>
                    <h3>Location</h3>
                    <p>{{ currentUser.location.latitude.toFixed(6) }}, {{ currentUser.location.longitude.toFixed(6) }}
                    </p>
                    <p>Accuracy: {{ currentUser.location.accuracy }}m</p>
                </ion-label>
            </ion-item>

            <ion-item lines="none">
                <ion-icon name="phone-portrait" slot="start"></ion-icon>
                <ion-label>
                    <h3>Device</h3>
                    <p>{{ currentUser.deviceInfo.model }} ({{ currentUser.deviceInfo.platform }})</p>
                    <p>{{ currentUser.deviceInfo.operatingSystem }} {{ currentUser.deviceInfo.osVersion }}</p>
                </ion-label>
            </ion-item>

            <ion-item lines="none">
                <ion-icon name="wifi" slot="start"></ion-icon>
                <ion-label>
                    <h3>Network</h3>
                    <p>{{ currentUser.networkInfo.connectionType || 'Unknown' }}</p>
                    <p>Connected: {{ currentUser.networkInfo.connected ? 'Yes' : 'No' }}</p>
                </ion-label>
            </ion-item>
        </ion-card-content>
    </ion-card>

    <!-- Users in Geofence -->
    <ion-card>
        <ion-card-header>
            <ion-card-title>Users in Trinidad Area ({{ usersInGeofence.length }})</ion-card-title>
        </ion-card-header>
        <ion-card-content>
            <ion-list *ngIf="usersInGeofence.length > 0; else noUsers">
                <ion-item *ngFor="let user of usersInGeofence">
                    <ion-avatar slot="start">
                        <ion-icon name="person-circle" size="large"></ion-icon>
                    </ion-avatar>
                    <ion-label>
                        <h2>{{ user.deviceInfo.model }}</h2>
                        <p>{{ user.deviceInfo.platform }} - {{ user.deviceInfo.operatingSystem }} {{
                            user.deviceInfo.osVersion }}</p>
                        <p>Last seen: {{ formatTimestamp(user.lastSeen) }}</p>
                        <p>Location: {{ user.location.latitude.toFixed(4) }}, {{ user.location.longitude.toFixed(4) }}
                        </p>
                    </ion-label>
                    <ion-chip [color]="getStatusColor(user.geofenceStatus)" slot="end">
                        <ion-label>{{ getStatusText(user.geofenceStatus) }}</ion-label>
                    </ion-chip>
                </ion-item>
            </ion-list>

            <ng-template #noUsers>
                <ion-item>
                    <ion-icon name="people" slot="start"></ion-icon>
                    <ion-label>
                        <h3>No other users in the geofence area</h3>
                        <p>You're the only one here right now</p>
                    </ion-label>
                </ion-item>
            </ng-template>
        </ion-card-content>
    </ion-card>

    <!-- All Users -->
    <ion-card>
        <ion-card-header>
            <ion-card-title>All Active Users ({{ allUsers.length }})</ion-card-title>
        </ion-card-header>
        <ion-card-content>
            <ion-list *ngIf="allUsers.length > 0; else noActiveUsers">
                <ion-item *ngFor="let user of allUsers">
                    <ion-avatar slot="start">
                        <ion-icon name="person-circle" size="large"></ion-icon>
                    </ion-avatar>
                    <ion-label>
                        <h2>{{ user.deviceInfo.model }}</h2>
                        <p>{{ user.deviceInfo.manufacturer }} - {{ user.deviceInfo.platform }}</p>
                        <p>{{ user.deviceInfo.operatingSystem }} {{ user.deviceInfo.osVersion }}</p>
                        <p>Network: {{ user.networkInfo.connectionType || 'Unknown' }}</p>
                        <p>Last seen: {{ formatTimestamp(user.lastSeen) }}</p>
                    </ion-label>
                    <ion-chip [color]="getStatusColor(user.geofenceStatus)" slot="end">
                        <ion-label>{{ getStatusText(user.geofenceStatus) }}</ion-label>
                    </ion-chip>
                </ion-item>
            </ion-list>

            <ng-template #noActiveUsers>
                <ion-item>
                    <ion-icon name="people" slot="start"></ion-icon>
                    <ion-label>
                        <h3>No active users found</h3>
                        <p>Waiting for other users to join...</p>
                    </ion-label>
                </ion-item>
            </ng-template>
        </ion-card-content>
    </ion-card>
</ion-content>